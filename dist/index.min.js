!function(){function e(e,t){this.el=e,this.config=Object.assign({},v,t),this.$init()}function t(){var e=[].slice.call(arguments),t=e.shift();e.forEach(function(e){t.appendChild(e)})}function s(e){e&&("function"==typeof e.remove?e.remove():e.parentNode.removeChild(e))}function i(e){for(var t in e)return!1;return!0}function n(e){return[].indexOf.call(e.parentNode.children,e)}function l(e,t,s){var i=document.createElement(e);return t&&Object.assign(i,t),s&&Object.assign(i.dataset,s),i}function a(e){return e?"?"+Object.keys(e).map(function(t){return t+"="+e[t]}).join("&"):""}function r(e,t){var s=new XMLHttpRequest;s.onreadystatechange=function(){if(4===s.readyState&&200===s.status){if(s.responseText){var e=JSON.parse(s.responseText);e?t(e):console.error(e)}}else if(s.status&&200!==s.status)throw new Error(s.responseText)},s.withCredentials=!0,s.open(e.method||"GET",e.url+a(e.params)),s.send()}function o(e,t,s,i,n){e.addEventListener(s,function(s){for(var l=s.target;l&&l!==e;)l.classList.contains(t)&&(i(l),n&&s.stopPropagation()),l=l.parentNode})}function c(e,t){if(e){if(Array.isArray(e)&&"function"==typeof e.forEach)return void e.forEach(t);for(var s in e)e.hasOwnProperty(s)&&t(e[s])}}var h="0.2.1",d={},u={"交易平台BU":{id:"bu",params:{time:"hour"}},"红包":{id:"redReward"},BOD:{id:"bod"},"高校":{id:"business/gx"},"白领":{id:"business/bl"},"早餐":{id:"breakfast"},"城市补贴与优惠":{id:"cityAllowance"},"城市":{id:"cityAllowance"}},f="/api/other/filter/",p=function(e,t){e.data&&200===e.code?t(e.data):console.error(e.code,e.message)},y="//npm.elemecdn.com/eleme-area-selector@"+h+"/dist/style.css",v={api:f,style:y,selectItemStyle:{height:27,display:20},selectSliceLength:200,typeMap:u,onReady:null,onChange:null,onTypeChange:null,loadingMessage:["正在加载资源...","正在请求数据..."],types:["交易平台BU"],responseHandler:p};e.version=h,e.prototype={$init:function(){if(this.el.innerHTML=this.config.loadingMessage[0],document.querySelector("[data-id=EAS-Style]"))this.$setCurrentType();else{var e=l("link",{rel:"stylesheet",href:this.config.style},{id:"EAS-Style"}),s=this;e.onload=function(){s.$setCurrentType()},t(document.head,e)}},$setCurrentType:function(e){e||(e=this.config.types[0]),this.config.onTypeChange&&this.config.onTypeChange(e),this.currentType=e,this.$load()},$load:function(){this.el.innerHTML=this.config.loadingMessage[1],this.model=[],this.data={},this.keyword="",this.selects={},i(this.refs)||this.$clear(),this.refs={},d[this.currentType]?this.$build(d[this.currentType]):r({url:this.config.api+this.config.typeMap[this.currentType].id,params:this.config.typeMap[this.currentType].params},function(e){this.config.responseHandler?this.config.responseHandler(e,this.$build.bind(this)):this.$build(e)}.bind(this))},$clear:function(){this.$eventsHandlerRemove.forEach(function(e){e()}),this.$eventsHandlerRemove=[],s(this.refs.container),s(this.refs.selectContainer)},$destroy:function(){this.$clear(),this.config.onChange=null,this.config.onReady=null,this.config.onTypeChange=null;var e=this;c(this,function(t){"function"==typeof t&&(e[t]=null)})},$addEventListener:function(e,t,s){e.addEventListener(t,s),this.$eventsHandlerRemove.push(function(){e.removeEventListener(t,s)})},$build:function(e){this.data=e,d[this.currentType]=e;var s=this.refs,i=this;this.$eventsHandlerRemove=[],s.container=l("div",{className:"eas-container"}),s.inputContainer=l("div",{className:"input-container"}),s.typeBox=l("div",{className:"type-box"}),s.type=l("div",{className:"current-type"}),s.typeList=l("ul",{className:"type-list"}),s.input=l("input",{className:"eas-input",type:"search"}),s.resultContainer=l("div",{className:"result-container"}),s.clearAll=l("div",{className:"clear-all",innerHTML:"清除全部"}),s.tags=l("div",{className:"eas-tags"}),s.selectContainer=l("div",{className:"eas-selects"}),this.el.innerHTML="",t(s.container,s.inputContainer,s.resultContainer),t(s.typeBox,s.type,s.typeList),t(s.inputContainer,s.typeBox,s.input),t(s.resultContainer,s.tags,s.clearAll),this.refs.type.innerHTML=this.currentType,this.$buildTypeList(),this.$addEventListener(document.body,"click",function(){i.$hideSelect(0)}),this.$addEventListener(this.refs.input,"click",function(e){i.$showSelect(),e.stopPropagation()}),this.$addEventListener(this.refs.input,"input",function(){i.$search()}),this.$addEventListener(this.refs.clearAll,"click",function(){i.$clearAll()}),o(this.refs.typeList,"type-list-item","click",function(e){i.$setCurrentType(e.textContent)},!0),o(this.refs.selectContainer,"eas-select-item","mousemove",function(e){if(e!==this.$lastMouseMoveTarget){this.$lastMouseMoveTarget=e,[].slice.call(e.parentNode.children).forEach(function(e){e.classList.contains("hover")&&e.classList.remove("hover")}),e.classList.add("hover");var t=e.parentNode.dataset.level,s=i.selects[t].data[n(e)];i.$showSelect(i.selects[t],s)}}),o(this.refs.selectContainer,"eas-select-item","click",function(e){i.$selectItem(i.selects[e.parentNode.dataset.level].display[n(e)]),e.classList.add("selected")},!0),o(this.refs.tags,"eas-tag","click",function(e){i.$removeItem(n(e))}),t(document.body,s.selectContainer),t(this.el,s.container),this.$buildMainSelelt(),this.data[0][0].forEach(function(e){i.$selectItem(e)}),this.config.onReady&&this.config.onReady()},$buildTypeList:function(){var e=this;this.config.types.length>1?(c(this.config.types,function(s){t(e.refs.typeList,l("li",{className:"type-list-item",innerHTML:s}))}),this.refs.type.classList.add("list")):s(this.refs.typeList)},$buildMainSelelt:function(){for(var e=0,s=[];this.data[e];)c(this.data[e],function(t){c(t,function(t){t.level=e,s.push(t)})}),e++;this.data.all=s;var i=this.refs.input.getBoundingClientRect();this.$selectTop=i.top+i.height;var n=this.$generateSelect(0);n.style.left=i.left-1+"px",n.style.top=this.$selectTop+"px",n.style.display="none",t(this.refs.selectContainer,n)},$showSelect:function(e,s){if(e){if(this.$hideSelect(e.level+1),s.level>=this.data.struct.length-1)return;var i=this.$generateSelect(s.level+1,s.i),n=e.el.getBoundingClientRect();i.style.top=this.$selectTop+"px",i.style.left=n.left+n.width-1+"px",t(this.refs.selectContainer,i)}else this.$refreshMainSelect(),this.selects[0].el.style.display="block",this.$hideSelect(1)},$hideSelect:function(e){for(0===e&&(this.selects[0].el.style.display="none",e++);e<this.data.struct.length;e++)this.selects[e]&&(s(this.selects[e].el),this.selects[e]=null)},$refreshMainSelect:function(){var e=this,t=this.data.all;this.keyword&&(t=this.data.all.filter(function(t){return t.n.toUpperCase().indexOf(e.keyword.toUpperCase())>-1})),this.$generateSelect(0,0,t)},$generateSelect:function(e,s,i){if(this.data[e]){0===e&&(s=0);var n=l("ul",{className:"eas-select"},{level:e}),a=this.data[e][s];0===e&&(a=this.data.all),i&&(a=i);var r={el:n,data:a,level:e,display:a,fullLoaded:!0},o=this,c=this.config.selectSliceLength,h=this.config.selectItemStyle.height,d=this.config.selectItemStyle.display;return a.length>c&&(r.fullLoaded=!1,r.display=a.slice(0,c),n.addEventListener("scroll",function(){r.fullLoaded||this.scrollTop/h+d>r.display.length&&(r.data.slice(r.display.length-1,r.display.length+c).forEach(function(e){t(n,o.$generateSelectItem(e))}),r.display=r.data.slice(0,r.display.length+c),r.display>=r.data&&(r.fullLoaded=!0))})),r.display.forEach(function(e){t(n,o.$generateSelectItem(e))}),this.selects[e]&&this.selects[e].el&&(Object.assign(n.style,this.selects[e].el.style),this.refs.selectContainer.replaceChild(n,this.selects[e].el)),this.selects[e]=r,n}},$generateSelectItem:function(e){var t="eas-select-item";this.model.some(function(t){return t.i===e.i&&t.level===e.level})&&(t+=" selected");var s=l("li",{className:t});return s.innerHTML="<small>"+e.level+"</small><i>"+this.data.struct[e.level]+"</i><span>"+e.n+"</span>",s},$setCurrentLevel:function(e){e>0&&e<this.data.struct.length?this.currentLevel=e:this.currentLevel=0},$selectItem:function(e){this.model.some(function(t){return t.i===e.i&&t.level===e.level})||(this.model.unshift(e),this.$setCurrentLevel(e.level),this.$refreshModel())},$removeItem:function(e){this.model.splice(e,1);var t=this.currentLevel;0===this.model.length?this.$setCurrentLevel(0):this.model.some(function(e){return e.level===t})||this.$setCurrentLevel(this.model[0].level),this.$refreshModel()},$clearAll:function(){this.model=[],this.$refreshModel()},getModel:function(){if(!this.model.length)return{level:"",data:""};var e={},t=this.currentLevel;return e.level=t+1,e.data=this.model.filter(function(e){return e.level===t}).map(function(e){return e.i}).join(","),e},$refreshModel:function(){var e=this.currentLevel;this.refs.tags.innerHTML=this.model.map(function(t){var s="eas-tag";return t.level!==e&&(s+=" disabled"),'<li class="'+s+'"><span>'+t.n+"</span><i></i></li>"}).join(""),this.config.onChange&&this.config.onChange()},$search:function(){this.keyword=this.refs.input.value.trim(),this.$showSelect()}},"object"==typeof exports?module.exports=e:window.AreaSelector=e}();